esphome:
  name: ac-ir-21
  friendly_name: AC IR 21

# Hardware:
# - Board: D1 Mini Pro (ESP8266)
esp8266:
  board: d1_mini_pro

# Enable logging
logger:

# Home Assistant API
# IMPORTANT: Do not commit real encryption keys to GitHub
api:
  encryption:
    key: !secret api_encryption_key #this is created automatically on first flash

# OTA updates
ota:
  - platform: esphome
    password: !secret ota_password #this is created automatically on first flash

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password #Your secret password for your wifi

  # Fallback hotspot if Wi-Fi fails
  ap:
    ssid: "Ac-Ir-21 Fallback Hotspot"
    password: !secret fallback_ap_password #this is created automatically on first flash, can be update as per wish

captive_portal:

# IR transmitter configuration
# Tip: Use a transistor + resistor to drive the IR LED for better range
remote_transmitter:
  id: ACIRTrans
  pin:
    number: GPIO04
  carrier_duty_percent: 25%

# Temperature source from Home Assistant
# This sensor is typically published by Zigbee2MQTT
sensor:
  - platform: homeassistant
    id: ACIR21
    entity_id: sensor.ac3_temperature   # CHANGE THIS to your own sensor
    internal: true
    filters:
      - throttle: 10s
      - heartbeat: 2min
      - debounce: 1s

    # Midea "Follow Me" functionality
    # Sends room temperature to the AC via IR
    on_value:
      then:
        - remote_transmitter.transmit_midea:
            transmitter_id: ACIRTrans
            code: !lambda |-
              // NOTE
              // This byte sequence is model/protocol specific.
              // The +1 temperature offset is intentional (tested with Midea).
              return {0xA4, 0x82, 0x48, 0x7F, (uint8_t)(id(ACIR21).state + 1)};

# IR climate controller (Midea)
climate:
  - platform: midea_ir
    name: "IR21"
    sensor: ACIR21
    supports_heat: false
    visual:
      min_temperature: 18.0 °C
      max_temperature: 32.0 °C
      temperature_step: 0.2 °C
